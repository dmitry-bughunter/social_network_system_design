# TRS - Системный дизайн

Домашнее задание для [курса по сист. дизайну](https://balun.courses/courses/system_design).
TRS - это социальная сеть для путешественников.

### Функциональные требования:

- Публикация постов из путешествий с фотографиями, небольшим описанием и привязкой к конкретному месту путешествия;
- Возможность оставить оценку поста;
- Возможность оставить комментарии на пост;
- Подписка на других путешественников;
- Поиск популярных мест для путешествий и просмотр постов с этих мест;
- Просмотр ленты других путешественников и ленты пользователя, основанной на подписках в обратном хронологическом порядке;

### Нефункциональные требования:
- Пост:
  - Пользователь выкладывает 20 постов в год (пользователи не путешевствуют ежедневно, соотвественно выкладывать посты тоже не будут каждый день.
    Пускай каждый пользователь путешевствуют 2 раза в год, и после каждого путешевствия выкладывает 10 постов)
  - Пользователь смотрит посты по месту 2 раза в неделю
  - Пользователь листает ленту(получает список постов) 5 раз в день
  - Средний размер картинки поста 1Мб
  - Среднее кол-во картинок - 5 шт
  - Средний размер описания 200 символов
  - Загрузка поста до 3 сек

- Лента:
  - Ленты (подписок, рекомендаций) для пользователя обновляются 1 раз в день
  - Получение страницы ленты до 2 сек

- Реакция (оценка + коммент по желанию):
  - Пользователь ставит 3 реакций в день
  - Пользователь просматривает 7 страниц реакций в день
  - Средний размер коммента 50 символов
  - Получение страницы реакций до 1 сек
  - Размер страницы: 10 

- Подписка:
  - Пользователь подписывается на 2 человека в неделю
  - Пользователь просматривает подписки/подписчиков 2 раза в месяц

- Локация:
  - Пользователь ищет популярные места для путешествий 1 раз в неделю
  - Пользователь указывает новую локацию в постах 5 раз в год  
- DAU = 10 000 000
- Данные: храним всегда
- Сезонность: больше активности летом
- Регион: СНГ
- Доступность: uptime 99.9%, время простоя в год ~ 8.76 ч 
- Клиенты: браузер, моб. устройства
- Лимит на подписки: 1 000 000
 
### Расчёт нагрузки

RPS (Посты):
    
    WRITE RPS = 10 000 000 * 20 / 365 / 86400 = 6.3
    READ  RPS = 10 000 000 * ((5 / 86400) + (2 / 7 * 86400)) = 611

RPS (Лента):

    READ  RPS = 10 000 000 * 5 / 86400  = 578

RPS (Реакции):

    WRITE RPS = 10 000 000 *  3 / 86400 = 347
    READ  RPS = 10 000 000 *  7 / 86400 = 810

RPS (Подписки):

    WRITE RPS =  10 000 000 *  1 / (7 * 86400) = 16.5
    READ  RPS =  10 000 000 *  2 / (30 * 86400) = 7.7

RPS (Локации):

    WRITE RPS =  10 000 000 *  5 / (365 * 86400) =  1.58
    READ  RPS =  10 000 000 *  1 / (7 * 86400) = 16.53 
 

### Трафик

Посты:

    average_size_of_post_info = 100 * 2 byte = 200b 
    average_size_of_images = 1Mb * 5 = 5Mb 

    WRITE TRAFFIC(info) = 6.3 * average_size_of_post_info = 6.3 * 200b = 1.23 Kb/s
    WRITE TRAFFIC(images) = 6.3 * average_size_of_images = 6.3 * 5Mb = 31.5 Mb/s

    READ TRAFFIC(info) = 611 * average_size_of_post_info = 119 Kb/s
    READ TRAFFIC(images) = 611 * average_size_of_images = 3 Gb/s

Лента:

    average_size_of_post_info = 100 * 2 byte = 200b 
    average_size_of_images = 1Mb * 5 = 5Mb 

    Допустим что запрос ленты возвращает страницу с 10 постами.

    READ TRAFFIC(info) = 578 * 10 * average_size_of_post_info = 1.1 Mb/s
    READ TRAFFIC(images) = 578 * 10 * average_size_of_images = 28.2 Gb/s

Реакции:

    average_size_of_reaction = comment_size + rating_size = 50 + 1 = 51 byte
    WRITE TRAFFIC = 347 * 51 byte = 17,3 Kb/s
    READ  TRAFFIC = 810 * 51 byte = 40.3 Kb/s

Подписки:

    Скорее всего нужно только ид на кого подписываемся, пусть это будет uuid 16 байт.
    WRITE TRAFFIC = 16.5 * 16 = 264 Byte/s

    В ответе будем отдавать список подписок, пускай будет ~ 0,5Kb
    READ  TRAFFIC = 7.7 * 0.5Kb = 3.85 Kb/s

Локации:

    Пусть запрос состоит из координат и названия.
    average_size_of_location = 20 * 1b + 50 * 2b = 120b
    WRITE TRAFFIC = 1.58 * 120b = 190 Byte/s

    Пусть ответ по локация будет списком из 10 объектов с координатами, названием, описанием и 1 фото,
    тогда response_size = (20 * 1b + 50 * 2b + 200 * 2b + 1024kb * 1024 ) * 10 = 10Mb 
    READ  TRAFFIC = 16.53 * 10 = 165.3 Mb/s

### Одновременные соединения

    Connections = 10 000 000 * 0.1 = 1 000 000
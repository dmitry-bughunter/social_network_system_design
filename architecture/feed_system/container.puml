@startuml
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Container.puml

Person(user, "User")
Container(reverseProxy, "Reverse proxy", "Nginx")
Container(apiGateway, "API Gateway", "Spring Cloud Gateway")
Container(postSystem, "Post system", "Software system", "Handles and stores posts")
Container(recommendSystem, "Recommend system", "Third-party software system", "Recommends post for user feed")
ContainerQueue(postMessageQueue, "Events queue", "Kafka", "Post events")
ContainerQueue(recommendationsMessageQueue, "Recommendations queue", "Kafka", "Recommended posts")

System_Boundary(feedSystem, "Feed system") {
Container(feedService, "Feed Service", "Java", "Generates personalized feeds of posts for users based on their subscriptions/recommendations", $tags="webApp")
ContainerDb(feedDatabase, "Feed database", "PostgreSQL", "Stores feeds",  $tags="db")
}

Rel(user, reverseProxy, "Gets feed", "REST")
Rel(reverseProxy, apiGateway, "Gets feed", "REST")
Rel(apiGateway, feedService, "Gets feed", "REST")
Rel(feedService, postSystem, "Gets post full info", "REST")
Rel(feedService, feedDatabase, "Gets/Saves feed items")

Rel(feedService, postMessageQueue, "Consume event and update followers feeds")
Rel(postSystem, postMessageQueue, "Produce post creation events")

Rel(recommendSystem, recommendationsMessageQueue, "Produce posts recommendations")
Rel(feedService, recommendationsMessageQueue, "Consume event and update recommended feed")
@enduml